(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{361:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"客户端文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端文档"}},[t._v("#")]),t._v(" 客户端文档")]),t._v(" "),a("h2",{attrs:{id:"ios"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ios"}},[t._v("#")]),t._v(" iOS")]),t._v(" "),a("h3",{attrs:{id:"快速集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速集成"}},[t._v("#")]),t._v(" 快速集成")]),t._v(" "),a("p",[t._v("通过Cocoapods集成")]),t._v(" "),a("ol",[a("li",[t._v("在Podfile中设置pod源。")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("source "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/uponup/JPSpec.git'")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在Podfile中添加下面内容。")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("pod "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MessageBroker'")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("执行"),a("code",[t._v("pod install")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),a("ol",[a("li",[t._v("导入头文件")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MessageBroker")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("初始化")])]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("AppDelegate")]),t._v("的"),a("code",[t._v("func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [:]) -> Bool")]),t._v("中，初始化SDK")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MavlMessageConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("appid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app-id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app-key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msgKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mesg-key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeSDK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/document/importGuide.html#创建应用"}},[t._v("获取AppId、AppKey和MesgKey")])],1)]),t._v(" "),a("h3",{attrs:{id:"push相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#push相关"}},[t._v("#")]),t._v(" PUSH相关")]),t._v(" "),a("ol",[a("li",[t._v("上传deviceToken")])]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("AppDelegate")]),t._v("的"),a("code",[t._v("func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data)")]),t._v("代理中，设置deviceToken")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" pushToken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" deviceToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("map")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%02.2hhx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("joined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDeviceToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tokenString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pushToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("登录"),a("code",[t._v("MB")]),t._v("服务器后，会自动上传DeviceToken")])]),t._v(" "),a("h3",{attrs:{id:"连接管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接管理"}},[t._v("#")]),t._v(" 连接管理")]),t._v(" "),a("ol",[a("li",[t._v("设置代理")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delegateMsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delegateLogin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("设置代理后，需要实现相应的代理方法")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("登录"),a("code",[t._v("MB")]),t._v("服务器")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("username")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登录的im账户")])]),t._v(" "),a("tr",[a("td",[t._v("password")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登录im的密码")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("退出登录")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("处理回调")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("协议")]),t._v(" "),a("th",[t._v("回调方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MavlMessageDelegate")]),t._v(" "),a("td",[t._v("func beginLogin()")]),t._v(" "),a("td",[t._v("开始登录")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func loginSuccess()")]),t._v(" "),a("td",[t._v("登录成功")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func logout(withError: Error?)")]),t._v(" "),a("td",[t._v("退出登录")])])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("异常断开后，如果客户端有重联机制，需要重新订阅好友状态")])]),t._v(" "),a("h3",{attrs:{id:"群组管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群组管理"}},[t._v("#")]),t._v(" 群组管理")]),t._v(" "),a("ol",[a("li",[t._v("设置代理")])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delegateGroup "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建群组")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("users")]),t._v(" "),a("td",[t._v("Set<String>")]),t._v(" "),a("td",[t._v("群组初始成员im_account的数组(应包含自己)")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("withUsers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("加入群组\nfunction")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("gid")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("想要加入的群组id")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("joinGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("withGroupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("退出群组")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("gid")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("想要退出的群组id")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("quitGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("withGroupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[t._v("处理回调")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("协议")]),t._v(" "),a("th",[t._v("回调方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MavlMessageGroupDelegate")]),t._v(" "),a("td",[t._v("func createGroupSuccess(groupId gid: String, isLauncher: Bool)")]),t._v(" "),a("td",[t._v("群组创建成功，isLauncher为true表示本人创建的群组")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func joinedGroup(groupId gid: String, someone: String)")]),t._v(" "),a("td",[t._v("表示someone成功加入群组gid")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func quitGroup(gid: String, error: Error?)")]),t._v(" "),a("td",[t._v("表示退出群组gid")])])])]),t._v(" "),a("h3",{attrs:{id:"消息管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息管理"}},[t._v("#")]),t._v(" 消息管理")]),t._v(" "),a("ol",[a("li",[t._v("发送消息 - 单聊")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("message")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要发送的文本内容")])]),t._v(" "),a("tr",[a("td",[t._v("toFriend")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("接收方imAccount")])]),t._v(" "),a("tr",[a("td",[t._v("localId")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("消息的本地唯一标识符")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, are u ok?"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" toFriend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"revecer-id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local-id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("发送消息 - 群组")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("message")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要发送的文本内容")])]),t._v(" "),a("tr",[a("td",[t._v("toGroup")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("目标群组id")])]),t._v(" "),a("tr",[a("td",[t._v("localId")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("消息的本地唯一标识符")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, are u ok?"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" toGroup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local-id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("发送消息 - VMUC")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("message")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要发送的文本内容")])]),t._v(" "),a("tr",[a("td",[t._v("toGroup")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("目标虚拟群组id")])]),t._v(" "),a("tr",[a("td",[t._v("localId")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("消息的本地唯一标识符")])]),t._v(" "),a("tr",[a("td",[t._v("withFriends")]),t._v(" "),a("td",[t._v("Set<String>")]),t._v(" "),a("td",[t._v("集合类型，圈子成员列表（包含自己）")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, are u ok?"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" toGroup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chatToId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" withFriends"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" friends"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("VMUC：虚拟群组，MessageBroker不维护群组信息，而是由业务层管理。")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("获取历史信息")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("msgId")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("message游标，想要获取哪条信息之后的信息")])]),t._v(" "),a("tr",[a("td",[t._v("from")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("gid/uid，拉取用户和某个好友的或者在某个群组中的数据")])]),t._v(" "),a("tr",[a("td",[t._v("type")]),t._v(" "),a("td",[t._v("Int")]),t._v(" "),a("td",[t._v("要获取群组信息还是个人信息，1:单聊，2:群聊")])]),t._v(" "),a("tr",[a("td",[t._v("offset")]),t._v(" "),a("td",[t._v("Int")]),t._v(" "),a("td",[t._v("偏移量，每次请求返回数据的数量")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MavlMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchMessages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msgId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1008'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("生产环境中禁止使用该接口")])]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("处理回调")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("协议")]),t._v(" "),a("th",[t._v("回调方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MavlMessageStatusDelegate")]),t._v(" "),a("td",[t._v("func mavl(willSend: "),a("code",[t._v("Mesg")]),t._v(")")]),t._v(" "),a("td",[t._v("即将发出信息")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func mavl(willResend: Mesg)")]),t._v(" "),a("td",[t._v("将要重发的信息（qos>0的时候，会有重发机制）")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func mavl(didRevceived messages: "),a("code",[t._v("[Mesg]")]),t._v(", isLoadMore: "),a("code",[t._v("Bool")]),t._v(")")]),t._v(" "),a("td",[t._v("收到信息，如果isLoadMore为true，则说明是从历史信息接口中获取到的信息")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("目前qos默认0，所以此接口目前不会有回调")]),t._v(" "),a("li",[t._v("消息发送失败的状态，客户端自行维护。如果在"),a("code",[t._v("didReceived")]),t._v("回调中收到了发出去的信息，说明发送成功了，否则消息状态为发送中或者发送失败。")])])]),t._v(" "),a("h3",{attrs:{id:"状态管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态管理"}},[t._v("#")]),t._v(" 状态管理")]),t._v(" "),a("ol",[a("li",[t._v("监听好友状态")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("username")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("被监听对象的im_account")])])])]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("StatusQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("处理回调")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("协议")]),t._v(" "),a("th",[t._v("回调方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("StatusQueueDelegate")]),t._v(" "),a("td",[t._v("func statusQueue(didOfflineUsers: "),a("code",[t._v("[String]")]),t._v(")")]),t._v(" "),a("td",[t._v("好友下线的回调")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("func statusQueue(didOnline user: "),a("code",[t._v("String")]),t._v(")")]),t._v(" "),a("td",[t._v("好友上线的回调")])])])]),t._v(" "),a("h2",{attrs:{id:"安卓"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安卓"}},[t._v("#")]),t._v(" 安卓")]),t._v(" "),a("h3",{attrs:{id:"快速集成-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速集成-2"}},[t._v("#")]),t._v(" 快速集成")]),t._v(" "),a("ol",[a("li",[t._v("下载android-im-sdk.aar")]),t._v(" "),a("li",[t._v("下载成功后，将aar添加到 libs 文件夹下，并在app/build.gradle文件下添加如下代码:")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("repositories "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   flatDir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       dirs "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./libs'")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("dependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   implementation "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fileTree")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'libs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.jar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("implementation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'android-im-sdk'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ext"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"初始化sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化sdk"}},[t._v("#")]),t._v(" 初始化SDK")]),t._v(" "),a("p",[t._v("在app的Applicarion类的onCreate()方法中添加全局配置，设置App Id,  App Key")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMGlobalConfig")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMGlobalConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMGlobalConfigBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAppId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAppToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDebug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMGlobalConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeSDK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/document/importGuide.html#创建应用"}},[t._v("获取AppId、AppKey和MesgKey")])],1)]),t._v(" "),a("h3",{attrs:{id:"连接管理-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接管理-2"}},[t._v("#")]),t._v(" 连接管理")]),t._v(" "),a("blockquote",[a("p",[t._v("获取登录MB服务的账号信息（username, password），该账号信息是登录客户端的账号管理平台成功后返回的，拿到账号信息登录MB服务，如果该账号信息不存在则创建账号并登录，否则直接登录。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("username")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登录的im账户名")])]),t._v(" "),a("tr",[a("td",[t._v("password")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登陆的im账户密码")])])])]),t._v(" "),a("ol",[a("li",[t._v("创建连接")])]),t._v(" "),a("ul",[a("li",[t._v("创建 "),a("code",[t._v("IMClientConfig")]),t._v(" 对象，主要配置连接MB的账户信息，以及连接设置，连接设置包含 连接超时时间，心跳时间，是否接收离线消息，掉线后是否自动重新连接等；")]),t._v(" "),a("li",[t._v("创建 "),a("code",[t._v("IMClientConfig")]),t._v(" 对象成功后通过 "),a("code",[t._v("IMMessageBroker.createMessageBroker(mContext, config)")]),t._v("创建IM客户端对象，该对象创建完成后，可进行MB服务的登录，登出，发送消息等操作；")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMClientConfig")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMClientConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUsername")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"client1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"client1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setKeepAlive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTlsConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCleanSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAutomaticReconnect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMMessageBroker")]),t._v(" client "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMMessageBroker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMessageBroker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("登录")])]),t._v(" "),a("blockquote",[a("p",[t._v("登录流程可以通过设置 IMMessageDelegate 监听登录事件")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("登出")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("回调处理")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("class")]),t._v(" "),a("th",[t._v("方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("IMMessageDelegate")]),t._v(" "),a("td",[t._v("loginSuccess()")]),t._v(" "),a("td",[t._v("登录MB服务成功")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("loginError(Throwable throwable)")]),t._v(" "),a("td",[t._v("登录MB服务失败")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("logoutSuccess()")]),t._v(" "),a("td",[t._v("登出MB服务成功")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("logoutError(Throwable throwable)")]),t._v(" "),a("td",[t._v("登出MB服务失败")])])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("异常断开后，如果客户端有重联机制，需要重新订阅好友状态")])]),t._v(" "),a("h3",{attrs:{id:"消息管理-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息管理-2"}},[t._v("#")]),t._v(" 消息管理")]),t._v(" "),a("blockquote",[a("p",[t._v("连接MB服务成功后，用户可以通过client对象进行消息发布，接收。")])]),t._v(" "),a("ol",[a("li",[t._v("发布消息")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("message")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要发送的文本内容")])]),t._v(" "),a("tr",[a("td",[t._v("isToGroup")]),t._v(" "),a("td",[t._v("Bool")]),t._v(" "),a("td",[t._v("是否是群组信息")])]),t._v(" "),a("tr",[a("td",[t._v("toId")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("接收者id，如果是群组信息则为gid，否则为uid")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendToMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClientId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("处理回调")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("class")]),t._v(" "),a("th",[t._v("方法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("IMMessageStatusDelegate")]),t._v(" "),a("td",[t._v("connectComplete(boolean reconnect, String serverURI)")]),t._v(" "),a("td",[t._v("连接MB完成（重新连接上）")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("connectionLost(Throwable cause)")]),t._v(" "),a("td",[t._v("因为网络等原因断开MB连接（掉线）")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("onSendingMessage(IMMessage imMessage)")]),t._v(" "),a("td",[t._v("正在发送的消息")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("onSendDoneMessage(IMMessage imMessage)")]),t._v(" "),a("td",[t._v("消息发送到IM总线")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("onReceivedMessage(IMMessage imMessage)")]),t._v(" "),a("td",[t._v("接收到IM总线发送的消息")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("onSendFailedMessage(IMMessage imMessage, Throwable exception)")]),t._v(" "),a("td",[t._v("发送消息失败")])])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("未完待续...")])]),t._v(" "),a("h2",{attrs:{id:"相关文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关文档"}},[t._v("#")]),t._v(" 相关文档")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/document/general.html#常见问题"}},[t._v("常见问题")])],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);