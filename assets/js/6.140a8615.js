(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{350:function(t,v,_){t.exports=_.p+"assets/img/msg_logic.bc60efe5.png"},351:function(t,v,_){t.exports=_.p+"assets/img/send_logic.8f7d573b.svg"},362:function(t,v,_){"use strict";_.r(v);var a=_(42),e=Object(a.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础知识"}},[t._v("#")]),t._v(" 基础知识")]),t._v(" "),a("h3",{attrs:{id:"自定义协议规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义协议规则"}},[t._v("#")]),t._v(" 自定义协议规则")]),t._v(" "),a("p",[t._v("小牛消息总线基于MQTT协议，实现IM功能。我们重新定义了MQTT中的Topic和Payload字段，并对其进行了封装。可将其归纳为三部分：发送、接收和订阅，具体定义规则见下表。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("协议规则")]),t._v(" "),a("th",[t._v("功能")]),t._v(" "),a("th",[t._v("Operation")]),t._v(" "),a("th",[t._v("Topic")]),t._v(" "),a("th",[t._v("Payload")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("发送")]),t._v(" "),a("td",[t._v("appid/operation/localid/uid")]),t._v(" "),a("td",[t._v("发送1v1信息")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("56/1/0")]),t._v(" "),a("td",[t._v("uid")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("appid/operation/localid/gid")]),t._v(" "),a("td",[t._v("创建群组")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("56/0/localid/gid")]),t._v(" "),a("td",[t._v("text")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("发送1vN信息")]),t._v(" "),a("td",[t._v("2")]),t._v(" "),a("td",[t._v("56/2/localid/gid")]),t._v(" "),a("td",[t._v("text")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("virtual group聊天")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("56/3/localid/gid")]),t._v(" "),a("td",[t._v("uid list#消息体")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("加入群聊")]),t._v(" "),a("td",[t._v("201")]),t._v(" "),a("td",[t._v("56/201/0/gid")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("退出群聊")]),t._v(" "),a("td",[t._v("202")]),t._v(" "),a("td",[t._v("56/201/0/gid")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("上传DeviceToken")]),t._v(" "),a("td",[t._v("300")]),t._v(" "),a("td",[t._v("56/300/0/gid")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("appid/operation/localid/from/type/cursor/offset")]),t._v(" "),a("td",[t._v("拉取历史信息")]),t._v(" "),a("td",[t._v("401")]),t._v(" "),a("td",[t._v("56/401/0/peter/1/cursor/10")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td",[t._v("接收")]),t._v(" "),a("td",[t._v("appid/1/localid/touid/serverid/fromuid")]),t._v(" "),a("td",[t._v("接收信息，根据Operation对信息进行分发")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("56/1/localid/touid/serverid/fromuid")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td",[t._v("订阅")]),t._v(" "),a("td",[t._v("appid/userstatus/uid/online")]),t._v(" "),a("td",[t._v("查看用户在线状态")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("56/userstatus/uid/online")]),t._v(" "),a("td",[t._v("-")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("备注：userList按照英文逗号,拼接后，在通过#与消息体连接。\n发送virtual group信息的时候，需要在Payload中携带userList，MB会根据userList将该信息分发给不同的用户，适用于有历史群组信息的场景。")])]),t._v(" "),a("h3",{attrs:{id:"sdk设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sdk设计"}},[t._v("#")]),t._v(" SDK设计")]),t._v(" "),a("p",[t._v("小牛消息总线主要实现了消息收发，群组管理，获取历史信息，查看用户状态等功能。通过梳理和归纳，我们将这些功能分别抽象到三个接口（协议）中来实现。")]),t._v(" "),a("h4",{attrs:{id:"mavlmessageclient"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessageclient"}},[t._v("#")]),t._v(" MavlMessageClient")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("主要负责IM相关功能。\n")])])]),a("h4",{attrs:{id:"mavlmessageclientstatus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessageclientstatus"}},[t._v("#")]),t._v(" MavlMessageClientStatus")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("主要负责通过pub/sub实现的相关功能，例如用户在线状态，个性化信息等。\n")])])]),a("h4",{attrs:{id:"mavlmessageclientconfig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessageclientconfig"}},[t._v("#")]),t._v(" MavlMessageClientConfig")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("主要负责配置信息上报的相关功能，例如上传DeviceToken，上传DeviceInfo等。\n")])])]),a("p",[t._v("实现了以上功能，我们还缺少一些必要的回调供给业务方调用，完成业务需求。在IM的业务场景下，我们同样抽象了三个协议，屏蔽掉实现细节，让业务方可以专注于自己的业务需求，而不是MQTT相关的实现。")]),t._v(" "),a("h4",{attrs:{id:"mavlmessagegroupdelegate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessagegroupdelegate"}},[t._v("#")]),t._v(" MavlMessageGroupDelegate")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("群组管理，好友管理相关回调，主要方法有：创建群组成功、加入群组成功、退出群组成功、添加好友成功、yan好友在线状态等。\n")])])]),a("h4",{attrs:{id:"mavlmessagedelegate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessagedelegate"}},[t._v("#")]),t._v(" MavlMessageDelegate")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("用户登录相关回调，主要方法有：开始登录，登录成功，登录失败等。\n")])])]),a("h4",{attrs:{id:"mavlmessagestatusdelegate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mavlmessagestatusdelegate"}},[t._v("#")]),t._v(" MavlMessageStatusDelegate")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("消息状态相关回调，主要方法有：将要发送消息，已经发送消息，收到消息等。\n")])])]),a("h3",{attrs:{id:"sdk类图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sdk类图"}},[t._v("#")]),t._v(" SDK类图")]),t._v(" "),a("h2",{attrs:{id:"配置登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置登录"}},[t._v("#")]),t._v(" 配置登录")]),t._v(" "),a("h3",{attrs:{id:"初始化sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化sdk"}},[t._v("#")]),t._v(" 初始化SDK：")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：实例化对象，将appID，appKey传递给SDK持有。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("appID")]),t._v(" "),a("td",[t._v("unsigned int")]),t._v(" "),a("td",[t._v("消息平台分发给App的唯一标识符")])]),t._v(" "),a("tr",[a("td",[t._v("appKey")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("消息平台分发给App的密钥")])]),t._v(" "),a("tr",[a("td",[t._v("msgKey")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("消息加密算法的key")])])])]),t._v(" "),a("h3",{attrs:{id:"登录-与mb建立长连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录-与mb建立长连接"}},[t._v("#")]),t._v(" 登录，与MB建立长连接：")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：根据协议定义，生成对应参数，调用MQTT SDK登录MB服务器。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("userID")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登录MB服务器的id")])]),t._v(" "),a("tr",[a("td",[t._v("userToken")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("用户登录MB服务器的密码")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("⚠️注意:  用户userID忽略大小写；\nMQTT SDK需要开启ssl校验，但是本地不校验证书；")])]),t._v(" "),a("h3",{attrs:{id:"退出登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#退出登录"}},[t._v("#")]),t._v(" 退出登录：")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：调用MQTT SDK disconnect方法，断开与MB服务器的长连接")]),t._v(" "),a("h2",{attrs:{id:"群组管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群组管理"}},[t._v("#")]),t._v(" 群组管理")]),t._v(" "),a("h3",{attrs:{id:"创建群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建群"}},[t._v("#")]),t._v(" 创建群")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：根据协议规则，Operation为0，生成相应的Topic。将userList中的用户id拼接按照appid_uid的格式成字符串作为Payload。然后调用MQTT SDK，将Payload信息Pub到对应的创建群组的Topic。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("usersList")]),t._v(" "),a("td",[t._v("Set")]),t._v(" "),a("td",[t._v("群初始成员列表")])])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("好友列表不可以重复")])]),t._v(" "),a("h3",{attrs:{id:"加入群-退出群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加入群-退出群"}},[t._v("#")]),t._v(" 加入群/退出群")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：加入群Operation为201，退出群Operation为202，生成相应的Topic，调用MQTT SDK，Pub一个空信息给该Topic。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("groupID")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要加入的群组的id")])])])]),t._v(" "),a("h3",{attrs:{id:"好友状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#好友状态"}},[t._v("#")]),t._v(" 好友状态")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：每个用户online或者offline的时候，MB会对所有订阅了appid/userstatus/uid/online 的用户发布状态信息，我们提供了观察好友在线状态的接口，以供业务方在合适的时机调用。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("uid")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要观察的用户id")])])])]),t._v(" "),a("h2",{attrs:{id:"消息管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息管理"}},[t._v("#")]),t._v(" 消息管理")]),t._v(" "),a("p",[t._v("我们在接收和发送消息的时候，必不可少地需要消息的一些状态、类型。下图是结合单聊、群组和vmuc三种消息类型，整理出来的消息处理逻辑表。表格中"),a("code",[t._v("Mesg数据模型部分字段")]),t._v("是在设计SDK中消息模型的时候，必须包含的几个字段。\n"),a("img",{attrs:{src:_(350),alt:"消息逻辑"}})]),t._v(" "),a("h3",{attrs:{id:"发送消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[t._v("#")]),t._v(" 发送消息")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：发送信息可以细分为1v1消息，1vN消息，虚拟群组信息，分别对应不同的Operation。参考协议规则，将消息Pub到相应的Topic。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("groupID（可选）")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("发送1vN信息时，接收的群组id")])]),t._v(" "),a("tr",[a("td",[t._v("userList（可选）")]),t._v(" "),a("td",[t._v("Set")]),t._v(" "),a("td",[t._v("发送virtual群组信息时候，群组成员的信息（包含自己）")])]),t._v(" "),a("tr",[a("td",[t._v("uid（可选）")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("发送1v1信息的，接收人id")])])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("userList中的成员不可以重复，所以此处采用了集合的数据类型，可以省去查重的步骤。")])]),t._v(" "),a("h3",{attrs:{id:"获取历史信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取历史信息"}},[t._v("#")]),t._v(" 获取历史信息")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：消息总线提供接口供我们获取一段时间内（7天）的历史数据，对应Operation为401。我们可以采用分页请求的方式，拉取7天内的数据。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("from")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("gid/uid，拉取用户和某个好友的或者在某个群组中的数据")])]),t._v(" "),a("tr",[a("td",[t._v("type")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("要获取群组信息还是个人信息，1:单聊，2:群聊")])]),t._v(" "),a("tr",[a("td",[t._v("cursor")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("发送1v1信息的，接收人id")])]),t._v(" "),a("tr",[a("td",[t._v("offset")]),t._v(" "),a("td",[t._v("Int")]),t._v(" "),a("td",[t._v("偏移量，一次请求要拉取的消息条数")])])])]),t._v(" "),a("h3",{attrs:{id:"多媒体消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多媒体消息"}},[t._v("#")]),t._v(" 多媒体消息")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("MB")]),t._v("中我们还支持了多媒体消息的收发。但是我们不保存资源，业务层使用的时候，只需要把资源的url传给SDK。多媒体消息类型以及数据格式如下表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("消息类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("协议类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("消息内容")]),t._v(" "),a("th",[t._v("样例")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("文本消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("sms://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("msg")]),t._v(" "),a("td",[t._v("sms://hello world")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("图片消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("image://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("image://http://file1.com/AB...CD.png")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("视频消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("video://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("video://http://file1.com/AB...CD.mp4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("音频消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("audio://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("audio://http://file1.com/AB...CD.mp3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("文件消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("file://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("file://http://file1.com/AB...CD.txt")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("位置消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("location://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("location://location?lantitude=118&longitude=38")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("富文本消息")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("richtext://")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("richtext")]),t._v(" "),a("td",[t._v('richtext://hello world <image src="./china.png">')]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("暂不实现")])])])]),t._v(" "),a("h4",{attrs:{id:"_1-发送步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-发送步骤"}},[t._v("#")]),t._v(" 1. 发送步骤")]),t._v(" "),a("p",[t._v("发送多媒体消息，分为以下几个步骤：")]),t._v(" "),a("ul",[a("li",[t._v("上传资源到文件服务器（"),a("code",[t._v("客户端自行处理")]),t._v("，SDK只需要接收资源url）")]),t._v(" "),a("li",[t._v("客户端发送消息API，SDK按照协议规定创建多媒体消息，利用mqtt，将消息发出去。")]),t._v(" "),a("li",[t._v("收到消息的时候，SDK需要对消息内容解析，然后将解析后的消息实体返回给客户端。")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("强制要求")]),t._v(" "),a("p",[t._v("SDK在实现多媒体消息解析的时候，根据URL解析"),a("code",[t._v("protocol://host:port/path?query")]),t._v("来获取多媒体消息的内容和参数。不可以利用特殊字符串自行处理。")])]),t._v(" "),a("h4",{attrs:{id:"_2-接口定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-接口定义"}},[t._v("#")]),t._v(" 2. 接口定义")]),t._v(" "),a("p",[t._v("在目前发送消息接口上新增发送多媒体消息的接口，传入"),a("code",[t._v("MultiMedia")]),t._v("类型的参数")]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaMesg msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MultiMedia")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" toFriend fid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaMesg msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("MultiMedia")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" toGroup gid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" withFriends fids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("原SDK中发送文本消息的接口，不必再单独实现发送逻辑，重载上面两个方法即可")])]),t._v(" "),a("p",[t._v("MultiMedia数据模型如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段名")]),t._v(" "),a("th",[t._v("type")]),t._v(" "),a("th",[t._v("url")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("类型")]),t._v(" "),a("td",[t._v("enum")]),t._v(" "),a("td",[t._v("string")])]),t._v(" "),a("tr",[a("td",[t._v("含义")]),t._v(" "),a("td",[t._v("消息类型")]),t._v(" "),a("td",[t._v("消息内容")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("type为枚举类型，不建议用字符串或者数字代替。理由是，这个接口面向用户，如果是enum的话，客户端传进来的参数是可控的，如果用其他类型，我们还需要考虑非法类型的问题。")])]),t._v(" "),a("h2",{attrs:{id:"push相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#push相关"}},[t._v("#")]),t._v(" PUSH相关")]),t._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：获取到设备的DeviceToken后，赋值给SDK实例对象。SDK会在合适的时机，例如成功建立连接，调用上传接口，将DeviceToken上传给MB服务器，以供后续PUSH功能使用。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("定义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("deviceToken")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("设备id，推送功能的唯一标识符")])])])]),t._v(" "),a("h3",{attrs:{id:"手动上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动上传"}},[t._v("#")]),t._v(" 手动上传")]),t._v(" "),a("p",[t._v("MB SDK实现逻辑：除了自动上传，我们还提供了额外的上传接口，供业务方主动调用。")]),t._v(" "),a("h2",{attrs:{id:"拓展知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展知识"}},[t._v("#")]),t._v(" 拓展知识")]),t._v(" "),a("p",[t._v("群组消息时序图：\n"),a("img",{attrs:{src:_(351),alt:"发布消息时序图"}})]),t._v(" "),a("h2",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[t._v("#")]),t._v(" 案例：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名")]),t._v(" "),a("th",[t._v("参数值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("appID")]),t._v(" "),a("td",[t._v("56")])]),t._v(" "),a("tr",[a("td",[t._v("appKey")]),t._v(" "),a("td",[t._v("c90265a583aaea81")])]),t._v(" "),a("tr",[a("td",[t._v("userId")]),t._v(" "),a("td",[t._v("user_A")])]),t._v(" "),a("tr",[a("td",[t._v("userToken")]),t._v(" "),a("td",[t._v("xxxxxx")])]),t._v(" "),a("tr",[a("td",[t._v("host")]),t._v(" "),a("td",[t._v("54.205.75.48")])]),t._v(" "),a("tr",[a("td",[t._v("port")]),t._v(" "),a("td",[t._v("443")])])])]),t._v(" "),a("h2",{attrs:{id:"术语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[t._v("#")]),t._v(" 术语：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MB")]),t._v(" "),a("td",[t._v("Message Broker，消息总线")])]),t._v(" "),a("tr",[a("td",[t._v("IM")]),t._v(" "),a("td",[t._v("Instance Messaging，即时通信")])])])])])}),[],!1,null,null,null);v.default=e.exports}}]);